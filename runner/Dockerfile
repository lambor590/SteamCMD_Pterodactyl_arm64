FROM arm64v8/debian:bookworm-slim

ENV DEBIAN_FRONTEND=noninteractive

# Set SHELL option explicitly
SHELL ["/bin/bash", "-o", "pipefail", "-c"]

# hadolint ignore=DL3008
RUN apt-get update \
	&& apt-get upgrade -y \
    && useradd -m -d /home/container container

COPY ./box64.sh /home/container/box64.sh
COPY ./entrypoint.sh /home/container/entrypoint.sh
RUN chmod +x /home/container/box64.sh /home/container/entrypoint.sh \
    && chown -R container:container /home/container

# Switch to user
USER container
ENV HOME=/home/container
WORKDIR /home/container

ENTRYPOINT ["/box64", "/bin/bash", "-c", "box64 ./steamcmd/steamcmd.sh +quit && box64 /entrypoint.sh"]